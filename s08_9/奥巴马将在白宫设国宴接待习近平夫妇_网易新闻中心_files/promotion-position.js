define(["jquery","core"],function(e,t){var i={},r=i.exports={};i.getPromotionData=function(){return e.ajax({url:"/getAdImg.do"}).then(function(t){var i=e.Deferred();if(200===+t.retCode)i.resolve(t);else i.reject();return i.promise()})};i.render=function(r){i.data=r||{};var a=t.entranceModule&&require(t.entranceModule).isIndexPage;if(a&&r.headerImg)i.renderLogoRight(r.headerImg);else e("#mLogoRight").show();if(a&&r.pcPopupImg&&r.pcPopupImg.img)i.renderPopup(r.pcPopupImg);if(a&&r.pcIndexImg&&r.pcIndexImg.img)i.renderPair(r.pcIndexImg);else i.renderSideDownload(r.appDownloadImg,a)};i.renderLogoRight=function(t){var i=e("#mLogoRight");if(t&&t.img){var r='<a href="<%=data.url%>" target="_blank" class="m-logo-promote-box"><img src="<%=data.img%>" width="236" height="54"></a>';i.html(e.template(r,t))}i.show()};i.renderPopup=function(t){var r="__INDEX__POPUP__";var a=LS.get(r);if(String(a)===String(t.lastModify))return;LS.set(r,t.lastModify);var n='<a href="<%=data.url%>" target="_blank"><img src="<%=data.img%>" alt="" /></a><a href="javascript:;" class="iDialogClose index-popup-close" title="关闭"></a>';i.preloadImg(t.img).then(function(i){e.dialog({title:null,width:i.width,height:i.height,button:[],css:"index-popup-dlg",animate:3,content:e.template(n,t)})})};i.renderPair=function(t){var r="__INDEX__PAIR__";var a=LS.get(r);if(String(a)===String(t.lastModify)){i.renderSideDownload(i.data.appDownloadImg,true);return}i.preloadImg(t.img).then(function(a){t.height=a.height;t.clickHeight=Math.min(t.height,450);var n='<div id="indexPairBg" class="index-pair-bg" style="height: <%=data.height%>px; background: url(<%=data.img%>) 50% 50% no-repeat rgb(255, 255, 255);"><div class="f-w990 index-pair-bg-inner"><a class="pair-left" style="height:<%=data.clickHeight%>px" href="<%=data.url%>" target="_blank"><span class="pair-close close-left" title="关闭"></span></a><a class="pair-right" style="height:<%=data.clickHeight%>px" href="<%=data.url%>" target="_blank"><span class="pair-close close-right" title="关闭"></span></a></div></div>';e("#indexContainer").parent().before(e.template(n,t));e("#indexPairBg").find(".pair-close").click(function(){e("#indexPairBg").remove();LS.set(r,t.lastModify);i.renderSideDownload(i.data.appDownloadImg);return false})})};i.renderSideDownload=function(i,r){if(i&&i.img)e("#j-codebox").find(".g-bigcodebox").css({background:"url("+i.img+") no-repeat center center"});t.rightFloatBoxInit();if(r){e("#j-codebox").mouseover();setTimeout(function(){e("#j-codebox").mouseout()},3e3)}};i.preloadImg=function(t){var i=e.Deferred();var r=new Image;r.onload=function(){i.resolve({width:this.width,height:this.height,src:this.src});i=null};setTimeout(function(){r.src=t;r=null},0);return i.promise()};r.init=function(){if(window.self!==window.top)return;setTimeout(function(){i.getPromotionData().then(i.render)},300)};return i.exports});