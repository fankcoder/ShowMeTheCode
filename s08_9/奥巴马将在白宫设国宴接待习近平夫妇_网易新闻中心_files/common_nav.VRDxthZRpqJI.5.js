!function(){var e,t,n,r,i,o,s,a,u,l,c,f,d=[].slice,m=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},h={}.hasOwnProperty,p=function(e,t){for(var n in t){if(h.call(t,n))e[n]=t[n]}function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},g=function(e,t){return function(){return e.apply(t,arguments)}};n={bind:function(e,t){var n,r,i,o,s;r=e.split(" ");n=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(o=0,s=r.length;o<s;o++){i=r[o];n[i]||(n[i]=[]);n[i].push(t)}return this},one:function(e,t){return this.bind(e,function(){this.unbind(e,arguments.callee);return t.apply(this,arguments)})},trigger:function(){var e,t,n,r,i,o,s;e=1<=arguments.length?d.call(arguments,0):[];n=e.shift();r=this.hasOwnProperty("_callbacks")&&((s=this._callbacks)!=null?s[n]:void 0);if(!r){return}for(i=0,o=r.length;i<o;i++){t=r[i];if(t.apply(this,e)===false){break}}return true},unbind:function(e,t){var n,r,i,o,s,a;if(!e){this._callbacks={};return this}i=(a=this._callbacks)!=null?a[e]:void 0;if(!i){return this}if(!t){delete this._callbacks[e];return this}for(r=o=0,s=i.length;o<s;r=++o){n=i[r];if(!(n===t)){continue}i=i.slice();i.splice(r,1);this._callbacks[e]=i;break}return this}};r={trace:true,logPrefix:"(App)",log:function(){var e;e=1<=arguments.length?d.call(arguments,0):[];if(!this.trace){return}if(this.logPrefix){e.unshift(this.logPrefix)}if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log.apply(console,e)}}return this}};f=["included","extended"];o=function(){e.include=function(e){var t,n,r;if(!e){throw new Error("include(obj) requires obj")}for(t in e){n=e[t];if(m.call(f,t)<0){this.prototype[t]=n}}if((r=e.included)!=null){r.apply(this)}return this};e.extend=function(e){var t,n,r;if(!e){throw new Error("extend(obj) requires obj")}for(t in e){n=e[t];if(m.call(f,t)<0){this[t]=n}}if((r=e.extended)!=null){r.apply(this)}return this};e.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}};e.prototype.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}};function e(){if(typeof this.init==="function"){this.init.apply(this,arguments)}}return e}();i=function(t){p(r,t);r.extend(n);r.records={};r.crecords={};r.attributes=[];r.configure=function(){var e,t;t=arguments[0],e=2<=arguments.length?d.call(arguments,1):[];this.className=t;this.records={};this.crecords={};if(e.length){this.attributes=e}this.attributes&&(this.attributes=c(this.attributes));this.attributes||(this.attributes=[]);this.unbind();return this};r.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"};r.find=function(e){var t;t=this.records[e];if(!t&&(""+e).match(/c-\d+/)){return this.findCID(e)}if(!t){throw new Error("Unknown record")}return t.clone()};r.findCID=function(e){var t;t=this.crecords[e];if(!t){throw new Error("Unknown record")}return t.clone()};r.exists=function(e){try{return this.find(e)}catch(t){return false}};r.refresh=function(e,t){var n,r,i,o;if(t==null){t={}}if(t.clear){this.records={};this.crecords={}}r=this.fromJSON(e);if(!u(r)){r=[r]}for(i=0,o=r.length;i<o;i++){n=r[i];n.id||(n.id=n.cid);this.records[n.id]=n;this.crecords[n.cid]=n}this.trigger("refresh",this.cloneArray(r));return this};r.select=function(e){var t,n,r;r=function(){var r,i;r=this.records;i=[];for(t in r){n=r[t];if(e(n)){i.push(n)}}return i}.call(this);return this.cloneArray(r)};r.findByAttribute=function(e,t){var n,r,i;i=this.records;for(n in i){r=i[n];if(r[e]===t){return r.clone()}}return null};r.findAllByAttribute=function(e,t){return this.select(function(n){return n[e]===t})};r.each=function(e){var t,n,r,i;r=this.records;i=[];for(t in r){n=r[t];i.push(e(n.clone()))}return i};r.all=function(){return this.cloneArray(this.recordsValues())};r.first=function(){var e;e=this.recordsValues()[0];return e!=null?e.clone():void 0};r.last=function(){var e,t;t=this.recordsValues();e=t[t.length-1];return e!=null?e.clone():void 0};r.count=function(){return this.recordsValues().length};r.deleteAll=function(){var e,t,n,r;n=this.records;r=[];for(e in n){t=n[e];r.push(delete this.records[e])}return r};r.destroyAll=function(){var e,t,n,r;n=this.records;r=[];for(e in n){t=n[e];r.push(this.records[e].destroy())}return r};r.update=function(e,t,n){return this.find(e).updateAttributes(t,n)};r.create=function(e,t){var n;n=new this(e);return n.save(t)};r.destroy=function(e,t){return this.find(e).destroy(t)};r.change=function(e){if(typeof e==="function"){return this.bind("change",e)}else{return this.trigger("change",e)}};r.fetch=function(e){if(typeof e==="function"){return this.bind("fetch",e)}else{return this.trigger("fetch",e)}};r.toJSON=function(){return this.recordsValues()};r.fromJSON=function(e){var t,n,r,i;if(!e){return}if(typeof e==="string"){e=JSON.parse(e)}if(u(e)){i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(new this(t))}return i}else{return new this(e)}};r.fromForm=function(){var e;return(e=new this).fromForm.apply(e,arguments)};r.recordsValues=function(){var e,t,n,r;t=[];r=this.records;for(e in r){n=r[e];t.push(n)}return t};r.cloneArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(t.clone())}return i};r.idCounter=0;r.uid=function(e){var t;if(e==null){e=""}t=e+this.idCounter++;if(this.exists(t)){t=this.uid(e)}return t};function r(e){r.__super__.constructor.apply(this,arguments);if(e){this.load(e)}this.cid=this.constructor.uid("c-")}r.prototype.isNew=function(){return!this.exists()};r.prototype.isValid=function(){return!this.validate()};r.prototype.validate=function(){};r.prototype.load=function(e){var t,n;for(t in e){n=e[t];if(typeof this[t]==="function"){this[t](n)}else{this[t]=n}}return this};r.prototype.attributes=function(){var e,t,n,r,i;t={};i=this.constructor.attributes;for(n=0,r=i.length;n<r;n++){e=i[n];if(e in this){if(typeof this[e]==="function"){t[e]=this[e]()}else{t[e]=this[e]}}}if(this.id){t.id=this.id}return t};r.prototype.eql=function(e){return!!(e&&e.constructor===this.constructor&&e.cid===this.cid||e.id&&e.id===this.id)};r.prototype.save=function(e){var t,n;if(e==null){e={}}if(e.validate!==false){t=this.validate();if(t){this.trigger("error",t);return false}}this.trigger("beforeSave",e);n=this.isNew()?this.create(e):this.update(e);this.trigger("save",e);return n};r.prototype.updateAttribute=function(e,t,n){this[e]=t;return this.save(n)};r.prototype.updateAttributes=function(e,t){this.load(e);return this.save(t)};r.prototype.changeID=function(e){var t;t=this.constructor.records;t[e]=t[this.id];delete t[this.id];this.id=e;return this.save()};r.prototype.destroy=function(e){if(e==null){e={}}this.trigger("beforeDestroy",e);delete this.constructor.records[this.id];delete this.constructor.crecords[this.cid];this.destroyed=true;this.trigger("destroy",e);this.trigger("change","destroy",e);this.unbind();return this};r.prototype.dup=function(e){var t;t=new this.constructor(this.attributes());if(e===false){t.cid=this.cid}else{delete t.id}return t};r.prototype.clone=function(){return a(this)};r.prototype.reload=function(){var e;if(this.isNew()){return this}e=this.constructor.find(this.id);this.load(e.attributes());return e};r.prototype.toJSON=function(){return this.attributes()};r.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"};r.prototype.fromForm=function(t){var n,r,i,o,s;r={};s=e(t).serializeArray();for(i=0,o=s.length;i<o;i++){n=s[i];r[n.name]=n.value}return this.load(r)};r.prototype.exists=function(){return this.id&&this.id in this.constructor.records};r.prototype.update=function(e){var t,n;this.trigger("beforeUpdate",e);n=this.constructor.records;n[this.id].load(this.attributes());t=n[this.id].clone();t.trigger("update",e);t.trigger("change","update",e);return t};r.prototype.create=function(e){var t,n;this.trigger("beforeCreate",e);if(!this.id){this.id=this.cid}n=this.dup(false);this.constructor.records[this.id]=n;this.constructor.crecords[this.cid]=n;t=n.clone();t.trigger("create",e);t.trigger("change","create",e);return t};r.prototype.bind=function(e,t){var n,r,i=this;this.constructor.bind(e,n=function(e){if(e&&i.eql(e)){return t.apply(i,arguments)}});this.constructor.bind("unbind",r=function(t){if(t&&i.eql(t)){i.constructor.unbind(e,n);return i.constructor.unbind("unbind",r)}});return n};r.prototype.one=function(e,t){var n,r=this;return n=this.bind(e,function(){r.constructor.unbind(e,n);return t.apply(r,arguments)})};r.prototype.trigger=function(){var e,t;e=1<=arguments.length?d.call(arguments,0):[];e.splice(1,0,this);return(t=this.constructor).trigger.apply(t,e)};r.prototype.unbind=function(){return this.trigger("unbind")};return r}(o);t=function(t){p(i,t);i.include(n);i.include(r);i.prototype.eventSplitter=/^(\S+)\s*(.*)$/;i.prototype.tag="div";function i(t){this.release=g(this.release,this);var n,r,o;this.options=t;o=this.options;for(n in o){r=o[n];this[n]=r}if(!this.el){this.el=document.createElement(this.tag)}this.el=e(this.el);this.$el=this.el;if(this.className){this.el.addClass(this.className)}if(this.attributes){this.el.attr(this.attributes)}if(!this.events){this.events=this.constructor.events}if(!this.elements){this.elements=this.constructor.elements}if(this.events){this.delegateEvents(this.events)}if(this.elements){this.refreshElements()}i.__super__.constructor.apply(this,arguments)}i.prototype.release=function(){this.trigger("release");this.el.remove();return this.unbind()};i.prototype.$=function(t){return e(t,this.el)};i.prototype.delegateEvents=function(e){var t,n,r,i,o,s,a=this;s=[];for(n in e){i=e[n];if(typeof i==="function"){i=function(e){return function(){e.apply(a,arguments);return true}}(i)}else{if(!this[i]){throw new Error(""+i+" doesn't exist")}i=function(e){return function(){a[e].apply(a,arguments);return true}}(i)}r=n.match(this.eventSplitter);t=r[1];o=r[2];if(o===""){s.push(this.el.bind(t,i))}else{s.push(this.el.delegate(o,t,i))}}return s};i.prototype.refreshElements=function(){var e,t,n,r;n=this.elements;r=[];for(e in n){t=n[e];r.push(this[t]=this.$(e))}return r};i.prototype.delay=function(e,t){return setTimeout(this.proxy(e),t||0)};i.prototype.html=function(e){this.el.html(e.el||e);this.refreshElements();return this.el};i.prototype.append=function(){var e,t,n;t=1<=arguments.length?d.call(arguments,0):[];t=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];i.push(e.el||e)}return i}();(n=this.el).append.apply(n,t);this.refreshElements();return this.el};i.prototype.appendTo=function(e){this.el.appendTo(e.el||e);this.refreshElements();return this.el};i.prototype.prepend=function(){var e,t,n;t=1<=arguments.length?d.call(arguments,0):[];t=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];i.push(e.el||e)}return i}();(n=this.el).prepend.apply(n,t);this.refreshElements();return this.el};i.prototype.replace=function(t){var n,r;r=[this.el,e(t.el||t)],n=r[0],this.el=r[1];n.replaceWith(this.el);this.delegateEvents(this.events);this.refreshElements();return this.el};return i}(o);e=(typeof window!=="undefined"&&window!==null?window.jQuery:void 0)||(typeof window!=="undefined"&&window!==null?window.Zepto:void 0)||function(e){return e};a=Object.create||function(e){var t;t=function(){};t.prototype=e;return new t};u=function(e){return Object.prototype.toString.call(e)==="[object Array]"};l=function(e){var t;if(!e){return true}for(t in e){return false}return true};c=function(e){return Array.prototype.slice.call(e,0)};s=this.Spine={};if(typeof module!=="undefined"&&module!==null){module.exports=s}s.version="1.0.8";s.isArray=u;s.isBlank=l;s.$=e;s.Events=n;s.Log=r;s.Module=o;s.Controller=t;s.Model=i;o.extend.call(s,n);o.create=o.sub=t.create=t.sub=i.sub=function(e,t){var n;n=function(e){p(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(this);if(e){n.include(e)}if(t){n.extend(t)}if(typeof n.unbind==="function"){n.unbind()}return n};i.setup=function(e,t){var n;if(t==null){t=[]}n=function(e){p(t,e);function t(){return t.__super__.constructor.apply(this,arguments)}return t}(this);n.configure.apply(n,[e].concat(d.call(t)));return n};s.Class=o}.call(this);!function(){var e=window.NTES||{};if(!e.event){e.event={}}e.plugin=e.plugin||{};e.event.Mouseenter=function(e,t,n){var r=document.createElement("div"),i="onmouseenter"in r,o=e,s="",a=n,u;switch(o){case"mouseenter":s="mouseover";break;case"mouseleave":s="mouseout";break;default:return null}o=i?o:s;u=i?t:function(e){var n=e.relatedTarget;if(!e.relatedTarget&&e.fromElement)e.relatedTarget=e.fromElement==e.target?e.toElement:e.fromElement;while(n&&n!=this){try{n=n.parentNode}catch(r){n=this}}if(n!=this){t.call(this,e)}};a.addEvent(o,u);return{eventName:o,eventHandler:u}}}();!function(e){var t=function(){var t=this;t.selector=".js_N_navSelect";t.unfoldClassName="ntes-nav-select-unfold";t.menus=e(t.selector);t.eventsCache=[];t.init();t.prevIndex=0};t.prototype={constructor:t,init:function(){var t=this;NTES.each(t.menus,function(n,r){var i=e(r),o={},s=NTES.event.Mouseenter("mouseenter",function(r){var i=e(this);if(t.timerList&&t.prevIndex===n){clearTimeout(t.timerList);t.timerList=undefined}else{t.timerList=setTimeout(function(){t.unfoldMenu(n);t.timerList=undefined},100)}},i),a=NTES.event.Mouseenter("mouseleave",function(r){var i=e(this);if(t.timerList&&t.prevIndex===n){clearTimeout(t.timerList);t.timerList=undefined}else{t.timerList=setTimeout(function(){t.foldMenu();t.timerList=undefined},100)}},i),u=function(n){var r=e(this);r.className.indexOf(t.unfoldClassName)===-1?r.addCss(t.unfoldClassName):r.removeCss(t.unfoldClassName)},l=function(r){var i=e(this);switch(r.keyCode){case 39:t.unfoldMenu(n);break;case 40:t.unfoldMenu(n);break;case 37:t.foldMenu();break;case 38:t.foldMenu();break;case 27:t.foldMenu();break;default:break}};i.addEvent("click",u).addEvent("keydown",l);o[s.eventName]=s.eventHandler;o[a.eventName]=a.eventHandler;o.click=u;o.keydown=l;t.eventsCache.push(o)})},unfoldMenu:function(t){var n=this;e(n.menus[n.prevIndex]).removeCss(n.unfoldClassName);e(n.menus[t]).addCss(n.unfoldClassName);n.prevIndex=t},foldMenu:function(){var t=this;e(t.menus[t.prevIndex]).removeCss(t.unfoldClassName)},destory:function(e,t){var n=this;if(!e){NTES.each(n.menus,function(e,t){var r=n.eventsCache[e];for(var i in r){t.removeEvent(i,r[i])}});return}var r=n._getItem(e),i=r?n.eventsCache[r.index]:null;if(!r){return}for(var o in i){r.item.removeEvent(o,i[o])}t&&t()},_getItem:function(t){var n=this,r=n.menus,i=0,o=r.length,s=e(t);if(!s){return null}s=s.get(0);for(;i<o;i++){if(r[i].get(0)==s){return{item:r[i],index:i}}}return null}};e.plugin=e.plugin||{};e.plugin.NTESSelectMenu=t}(NTES);!function(){var e=this,t=function(){};e.NTESCommonNavigator=e.NTESCommonNavigator||{};e.console=e.console||{log:t,error:t,trace:t,info:t};e.NTESCommonNavigator.namespace=function(){var t=arguments,n=null,r,i,o,s;for(r=0,s=t.length;r<s;r++){o=(""+t[r]).split(".");n=e.NTESCommonNavigator;for(i=o[0]=="NTESCommonNavigator"?1:0;i<o.length;i=i+1){n[o[i]]=n[o[i]]||{};n=n[o[i]]}}return n}}.call(this);NTESCommonNavigator.namespace("NTESCommonNavigator.core");NTESCommonNavigator.core.Constant={Path:{WB_PATH:"http://t.163.com/service/newMessage/",DEFAULT_MAIL_PATH:"http://email.163.com#from=163nav_icon"},Domain:{DOMAIN:["126.com","yeah.net","163.com","188.com","vip.163.com","vip.126.com"],API:["mail.126.com","mail.yeah.net","mail.163.com","mail.188.com","vip.163.com","vip.126.com"]},PRODUCTS:{reg:{name:"\u7528\u6237\u4e2d\u5fc3",url:"http://reg.163.com/Main.jsp?username=pInfo"},"163.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://entry.mail.163.com/coremail/fcg/ntesdoor2?verifycookie=1&lightweight=1&df=163navi"},"126.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://entry.mail.126.com/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1&df=163navi"},"vip.126.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://reg.vip.126.com/enterMail.m"},"yeah.net":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://entry.yeah.net/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1&def=163navi"},"188.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://reg.mail.188.com/servlet/enter"},"vip.163.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://reg.vip.163.com/enterMail.m?enterVip=true-----------"},lofter:{name:"\u6211\u7684LOFTER",url:"http://www.lofter.com/?act=qb163rk_20141031_02"},photo:{name:"\u6211\u7684\u76f8\u518c",url:"http://photo.163.com/?username=pInfo"},yuehui:{name:"\u6211\u7684\u540c\u57ce\u7ea6\u4f1a",url:"http://yuehui.163.com/"},blog:{name:"\u6211\u7684\u535a\u5ba2",url:"http://blog.163.com/passportIn.do?entry=163"},ht:{name:"\u6211\u7684\u82b1\u7530",url:"http://love.163.com?keyfrom=163site.mynavi"},note:{name:"\u6211\u7684\u4e91\u7b14\u8bb0",url:"http://note.youdao.com/web?entry=163.com"},caipiaoyys:{name:"\u6211\u7684\u5f69\u7968",url:"http://caipiao.163.com/#from=www_top_entry"},guijinshu:{name:"\u6211\u7684\u8d35\u91d1\u5c5e",url:"http://fa.163.com/?from=tgnwscj"},cx:{name:"\u6211\u7684\u8f66\u9669",url:"http://baoxian.163.com/car/?from=www_top_entry"},baoxian:{name:"\u6211\u7684\u4fdd\u9669",url:"http://baoxian.163.com/?from=www_top_entry"},shop:{name:"\u7f51\u6613\u5546\u57ce",url:"http://mall.163.com/#from=www_top_entry"},easyread:{name:"\u7f51\u6613\u4e91\u9605\u8bfb",url:"http://yuedu.163.com/#f=topnav"}},DEFAULT_PRODUCTS:["lofter","photo","ht","yuehui","blog","note","caipiaoyys","guijinshu","cx","baoxian","shop","easyread"],LOG_IN_OUT_URL:"http://reg.163.com/Logout.jsp"};NTESCommonNavigator.namespace("NTESCommonNavigator.core");NTESCommonNavigator.core.Event={Base:{DATA_LOADED:"event_core_data_loaded",DATA_FAILED:"event_core_data_failed",DATA_CHANGED:"event_core_data_changed",LOGIN_SUCCESS:"event_core_login_sucess",LOGIN_FAIL:"event_core_login_fail"},Model:{MAIL_INFO_LOADED:"event_model_mail_info_loaded",LOFTER_INFO_LOADED:"event_model_lofter_info_loaded"}};NTESCommonNavigator.namespace("NTESCommonNavigator.base");NTESCommonNavigator.base.Class=function(){var e=Spine.Class.create(),t=Spine.Events;e.include(Spine.Events);e.include({extend:e.extend});return new e};NTESCommonNavigator.namespace("NTESCommonNavigator.base");NTESCommonNavigator.base.UI=function(){var e=NTESCommonNavigator.base.Class(),t=function(){};t();e.extend({});return e};!function(){var e={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"};NTESCommonNavigator.namespace("NTESCommonNavigator.utils");NTESCommonNavigator.utils.mix={encode:function(t){return t.replace(/[&"'<>]/g,function(t){return e[t]})}}}();NTESCommonNavigator.namespace("NTESCommonNavigator.utils");NTESCommonNavigator.utils.Suggestion=function(){var e=NTESCommonNavigator.base.Class();String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)};function t(){var e=document.getElementById("js_passportUserNameList");var t=r.getXY(i.usernameInputElement).x;var n=r.getXY(i.usernameInputElement).y;e.style.left=t+"px";e.style.top=n+i.usernameInputElement.offsetHeight+"px"}function n(e){var t=document.createElement("div");t.innerHTML=e;document.body.appendChild(t.firstChild);t=null}var r={getXY:function(e){var t=0,n=0;while(e!=document.body&&e!=null){n+=e.offsetLeft;t+=e.offsetTop;e=e.offsetParent}return{x:n,y:t}}};var i={usernameInputElement:false,usernameInputElementX:false,usernameInputElementY:false,usernameInputHeight:false,usernameListElement:false,currentSelectIndex:-1,hasShow:false,domainSelectElmentString:'<div id = "js_passportUserNameList" class="ntes-domain-selector"  style="display: none;"><div class="ntes-domain-selector-main"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="ntes-domain-selector-title">\u8bf7\u9009\u62e9\u6216\u7ee7\u7eed\u8f93\u5165...</td></tr><tr><td><td /></tr></tbody></table></div><iframe src="javascript:\'\';"  style=" z-index:1008;width:100%;height:0px;display:block  " frameborder="0"></iframe></div><div style="display: none;"></div><div id="passport_111"></div>',domainSelectElement:false,domainArray:["163.com","126.com","yeah.net","vip.163.com","vip.126.com","popo.163.com","188.com","vip.188.com","qq.com","yahoo.com","sina.com"],helpDivString:'<div style="width:100%;" id="passport_helper_div"></div>',resizeFunc:function(){var e=document.getElementById("js_passportUserNameList");var t=r.getXY(i.usernameInputElement).x;var n=r.getXY(i.usernameInputElement).y;e.style.left=t+"px";e.style.top=n+i.usernameInputElement.offsetHeight+"px"},bind:function(e){this.usernameInputElement=e;var t=r.getXY(this.usernameInputElement);this.usernameInputElementX=t.x;this.usernameInputElementY=t.y;this.handle()},handle:function(){n(this.domainSelectElmentString);n(this.helpDivString);this.domainSelectElement=document.getElementById("js_passportUserNameList");this.usernameListElement=this.domainSelectElement.firstChild.firstChild.rows[1].firstChild;this.currentSelectIndex=0;this.usernameInputElement.onblur=function(e){i.preventEvent(e);setTimeout(function(){i.doSelect()},200);return false};try{this.usernameInputElement.addEventListener("keypress",this.keypressProc,false);this.usernameInputElement.addEventListener("keyup",this.keyupProc,false)}catch(e){try{this.usernameInputElement.attachEvent("onkeydown",this.checkKeyDown);this.usernameInputElement.attachEvent("onkeypress",this.keypressProc);this.usernameInputElement.attachEvent("onkeyup",this.keyupProc)}catch(e){}}t();if(navigator.userAgent.indexOf("MSIE")>0){window.attachEvent("onresize",t)}else{window.onresize=t}},preventEvent:function(e){try{e.cancelBubble=true;e.returnValue=false;if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}}catch(e){}},checkKeyDown:function(e){this.currentSelectIndex=0;var t=e.keyCode;if(t==38||t==40){i.preventEvent(e);i.clearFocus();if(t==38){i.upSelectIndex()}else{i.downSelectIndex()}i.setFocus();return false}},keyupProc:function(e){this.currentSelectIndex=0;var t=e.keyCode;i.changeUsernameSelect();if(t==13){i.doSelect()}var n;if((n=navigator.userAgent.indexOf("Safari"))>0){if(t==38||t==40){i.preventEvent(e);i.clearFocus();if(t==38){i.upSelectIndex()}else{i.downSelectIndex()}i.setFocus()}}return false},keypressProc:function(e){this.currentSelectIndex=0;var t=e.keyCode;if(t==13){i.preventEvent(e)}else{if(t==38||t==40){i.preventEvent(e);i.clearFocus();if(t==38){i.upSelectIndex()}else{i.downSelectIndex()}i.setFocus()}else{if(t==108||t==110||t==111||t==115){setTimeout(function(){i.changeUsernameSelect()},20)}}}},clearFocus:function(e){var e=this.currentSelectIndex;try{var t=this.findTdElement(e);t.style.backgroundColor="white"}catch(n){}},findTdElement:function(e){try{var t=this.usernameListElement.firstChild.rows;for(var n=0;n<t.length;++n){if(t[n].firstChild.idx==e){return t[n].firstChild}}}catch(r){}return false},upSelectIndex:function(){var e=this.currentSelectIndex;if(this.usernameListElement.firstChild==null){return}var t=this.usernameListElement.firstChild.rows;var n;for(n=0;n<t.length;++n){if(t[n].firstChild.idx==e){break}}if(n==0){this.currentSelectIndex=t.length-1}else{this.currentSelectIndex=t[n-1].firstChild.idx}},downSelectIndex:function(){var e=this.currentSelectIndex;if(this.usernameListElement.firstChild==null){return}var t=this.usernameListElement.firstChild.rows;var n=0;for(;n<t.length;++n){if(t[n].firstChild.idx==e){break}}if(n>=t.length-1){this.currentSelectIndex=t[0].firstChild.idx}else{this.currentSelectIndex=t[n+1].firstChild.idx}},setFocus:function(){var e=this.currentSelectIndex;try{var t=this.findTdElement(e);t.style.backgroundColor="#D5F1FF"}catch(n){}},changeUsernameSelect:function(){var e=this.usernameInputElement.value;e=e.replaceAll("<","");if(e.trim()==""){this.domainSelectElement.style.display="none";this.hasShow=false}else{var n="",r="";var o;if((o=e.indexOf("@"))<0){n=e;r=""}else{n=e.substr(0,o);r=e.substr(o+1,e.length)}var s=[];if(r==""){for(var a=0;a<this.domainArray.length;++a){s.push(n+"@"+this.domainArray[a])}}else{for(var a=0;a<this.domainArray.length;++a){if(this.domainArray[a].indexOf(r)==0){s.push(n+"@"+this.domainArray[a])}}}if(s.length>0){t();this.domainSelectElement.style.display="block";this.hasShow=true;var u=document.createElement("TABLE");u.cellSpacing=0;u.cellPadding=3;var l=document.createElement("TBODY");u.appendChild(l);for(var a=0;a<s.length;++a){var c=document.createElement("TR");var f=document.createElement("TD");f.nowrap="true";f.align="left";f.innerHTML=s[a];f.idx=a;f.onmouseover=function(){i.clearFocus();i.currentSelectIndex=this.idx;i.setFocus();this.style.cursor="hand"};f.onmouseout=function(){};f.onclick=function(e){i.doSelect();i.preventEvent(e);return false};c.appendChild(f);l.appendChild(c)}this.usernameListElement.innerHTML="";this.usernameListElement.appendChild(u);var d=0;for(var m=0;m<s.length;++m){if(s[m].length>d)d=s[m].length}d=d*10;if(d<185)d=185;u.style.width=d+"px";this.domainSelectElement.style.width=u.style.width;this.setFocus()}else{this.domainSelectElement.style.display="none";this.hasShow=false;this.currentSelectIndex=-1}}},doSelect:function(){this.domainSelectElement.style.display="none";this.hasShow=false;if(this.usernameInputElement.value.trim()==""){return}var e=this.findTdElement(this.currentSelectIndex);if(e){this.usernameInputElement.value=e.innerHTML;this.usernameInputElement.value=this.usernameInputElement.value.replaceAll("<","")}}};e.extend({getInstance:function(){return i}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.utils");NTESCommonNavigator.utils.Login=function(){var e=NTESCommonNavigator.base.Class(),t=NTESCommonNavigator.core.Event.Base;try{document.domain="163.com"}catch(n){}var r=NTESCommonNavigator.utils.Suggestion().getInstance(),i={listenFrame:true,loginAction:"https://reg.163.com/logins.jsp",loginRedirect:"http://reg.163.com/redirect.jsp",successAction:"",failedAction:"",success:{},failed:{},errorMsg:{412:"\u60a8\u5c1d\u8bd5\u7684\u6b21\u6570\u5df2\u7ecf\u592a\u591a,\u8bf7\u8fc7\u4e00\u6bb5\u65f6\u95f4\u518d\u8bd5",414:"\u60a8\u7684IP\u767b\u5f55\u5931\u8d25\u6b21\u6570\u8fc7\u591a,\u8bf7\u7a0d\u540e\u518d\u8bd5",415:"\u60a8\u4eca\u5929\u767b\u5f55\u9519\u8bef\u6b21\u6570\u5df2\u7ecf\u592a\u591a,\u8bf7\u660e\u5929\u518d\u8bd5",416:"\u60a8\u7684IP\u4eca\u5929\u767b\u5f55\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",417:"\u60a8\u7684IP\u4eca\u5929\u767b\u5f55\u6b21\u6570\u8fc7\u591a\uff0c\u8bf7\u660e\u5929\u518d\u8bd5",418:"\u60a8\u4eca\u5929\u767b\u5f55\u6b21\u6570\u8fc7\u591a,\u8bf7\u660e\u5929\u518d\u8bd5",419:"\u60a8\u7684\u767b\u5f55\u64cd\u4f5c\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5",420:"\u7528\u6237\u540d\u4e0d\u5b58\u5728",422:"\u5e10\u53f7\u88ab\u9501\u5b9a\uff0c\u8bf7\u60a8\u89e3\u9501\u540e\u518d\u767b\u5f55",424:"\u8be5\u9753\u53f7\u670d\u52a1\u5df2\u5230\u671f\uff0c\u8bf7\u60a8\u7eed\u8d39",425:"\u5916\u57df\u5e10\u53f7\u5e76\u4e14\u5728\u6fc0\u6d3b\u6709\u6548\u671f\u4ee5\u5185",426:"\u5916\u57df\u5e10\u53f7\u5e76\u4e14\u5df2\u7ecf\u8fc7\u4e86\u6fc0\u6d3b\u6709\u6548\u671f\u9650",427:"\u8d85\u65f6\uff0c\u5df2\u8d85\u8fc75\u5206\u949f\u6709\u6548\u671f",428:"\u9700\u8981\u8fdb\u5165\u4e2d\u95f4\u63d0\u9192\u9875\u9762",460:"\u5bc6\u7801\u4e0d\u6b63\u786e",500:"\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u60a8\u7a0d\u540e\u518d\u8bd5",503:"\u7cfb\u7edf\u7ef4\u62a4\uff0c\u8bf7\u60a8\u7a0d\u540e\u518d\u8bd5",1e3:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u7528\u6237\u540d"},commit:function(e){if(!e){return}!this.frame&&this.createElements();this.username.value=e.username;this.password.value=e.password;this.type.value=e.type;this.product.value=e.product;this.savelogin.value=e.savelogin;this.url.value=this.successAction;this.url2.value=this.failedAction;this.noRedirect.value=1;this.form.submit()},verifyLogin:function(){if(this.verifyCookie&&this.verifyCookie()){for(var e in this.success){if(typeof this.success[e]==="function"){this.success[e].call(this,arguments[0])}}}else{for(var e in this.failed){if(typeof this.failed[e]==="function"){arguments[0]&&(arguments[0].errorMsg=this.errorMsg[this.errorMsg[arguments[0].errorType]?arguments[0].errorType:1e3]);this.failed[e].call(this,arguments[0])}}}},getSearches:function(e){e=e||window.location.search;var t=e.substring(1),n=t.split("&"),r={};for(var i=0;i<n.length;i++){var o=n[i].split("=");o[0]&&(r[o[0]]=o[1]||null)}return r},createElements:function(){this.frame=this.createFrame();this.form=this.createForm();this.username=this.createInput("username");this.password=this.createInput("password");this.type=this.createInput("type");this.product=this.createInput("product");this.savelogin=this.createInput("savelogin");this.url=this.createInput("url");this.url2=this.createInput("url2");this.noRedirect=this.createInput("noRedirect");this.form.appendChild(this.username);this.form.appendChild(this.password);this.form.appendChild(this.type);this.form.appendChild(this.product);this.form.appendChild(this.savelogin);this.form.appendChild(this.url);this.form.appendChild(this.url2);this.form.appendChild(this.noRedirect);document.body.appendChild(this.form);document.body.appendChild(this.frame)},createInput:function(e){var t=this.toElement("<input/>");t.setAttribute("name",e);return t},toElement:function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;e.removeChild(n);return n}}(),createFrame:function(){var e=this,t,n="login_util_frame",r=0;t=e.toElement('<iframe src="javascript:false;" name="'+n+'" />');t.setAttribute("id",n);t.setAttribute("border","no");t.style.display="none";t.onload=t.onreadystatechange=function(){if(!e.listenFrame){return}if(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"){if(r||this.contentWindow.location.search){e.verifyLogin(e.getSearches(this.contentWindow.location.search))}r++}};return t},createForm:function(){var e=this,t;t=e.toElement('<form method="post"></form>');t.setAttribute("id","login_util_form");t.setAttribute("action",this.loginAction);t.setAttribute("target",this.frame.name);t.style.display="none";return t}};i.verifyCookie=function(){var e=NTES.cookie.get("S_INFO"),t=NTES.cookie.get("P_INFO");return e&&t[2]!="2"};i.successAction="http://www.163.com/special/0077450P/login_frame.html";i.failedAction="http://www.163.com/special/0077450P/login_frame.html";i.success.userProduct=function(e){o.loginSuccess(e)};i.failed.userProduct=function(e){o.loginFailed(e)};var o={logined:false,mailReg:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,trimReg:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,formEl:NTES("#js_N_login_wrap"),fieldEl:NTES("#js_N_login_wrap input"),submitEl:NTES("#js_N_login_wrap .ntes-loginframe-btn"),tipEl:NTES("#js_N_login_wrap .ntes-loginframe-tips"),nameTmp:"",passTmp:"",passportLoaded:false};o.nameField=o.fieldEl[0];o.passField=o.fieldEl[1];o.saveField=o.fieldEl[2];o.tipText=o.tipEl[0].innerHTML;o.passField.type="password";r.bind(o.nameField);o.filter={"163.com":{read:1,name:"163",url:"http://entry.mail.163.com/coremail/fcg/ntesdoor2?verifycookie=1&lightweight=1"},"126.com":{read:1,name:"126",url:"http://entry.mail.126.com/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1"},"yeah.net":{read:1,name:"yeah",url:"http://entry.yeah.net/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1"},"188.com":{read:0,name:"188",url:"http://reg.mail.188.com/servlet/enter"},"vip.126.com":{read:0,name:"vip",url:"http://reg.vip.126.com/enterMail.m"},"vip.163.com":{read:0,name:"vip",url:"http://reg.vip.163.com/enterMail.m?enterVip=true-----------"}};o.trim=function(e){return e?(e+"").replace(o.trimReg,""):""};o.verifyFields=function(e,t){var n=o.nameField,r=o.passField;if(e.length==0){o.addClass(n.parentNode,"tips-error");this.loginFailed();n.focus();return false}else if(t.length==0){o.addClass(r.parentNode,"tips-error");r.focus();this.loginFailed();return false}return true};o.submit=function(){var e,t=o.trim(o.nameField.value),n=o.passField.value,r=o.saveField.checked?1:0;o.nameTmp=t;o.passTmp=n;if(!o.verifyFields(t,n)){return}e={username:t,password:n,savelogin:r,product:"163",type:1};
i.commit(e)};o.loginSuccess=function(n){o.logined=true;e.trigger(t.LOGIN_SUCCESS)};o.loginFailed=function(n){o.logined=false;e.trigger(t.LOGIN_FAIL);o.showError(n&&n.errorMsg?n.errorMsg:o.tipText);if(!n){return}switch(parseInt(n.errorType)){case 420:setTimeout(function(){o.nameField.focus()},1e3);break;case 428:window.open(n.url?[unescape(n.url),"url="+location.href].join("&"):i.loginRedirect,"_self");break;case 460:setTimeout(function(){o.passField.focus()},1e3);break;default:break}};o.showError=function(e){o.tipEl[0].innerHTML=e};o.hasClass=function(e,t){var n="*"+e.className.replace(/\s+/gi,"*")+"*";return n.indexOf("*"+t+"*")!=-1};o.addClass=function(e,t){if(o.hasClass(e,t)){return}var n=e.className+" "+t;e.className=o.trim(n)};o.removeClass=function(e,t){if(!o.hasClass(e,t)){return}var n="*"+e.className.replace(/\s+/gi,"*")+"*";n=n.replace(new RegExp("\\*"+t+"\\*","ig")," ").replace(/\*/gi," ");e.className=o.trim(n)};o.submitEl.addEvent("click",function(){o.submit()});o.formEl.addEvent("keydown",function(e){if(e.keyCode==13&&!i.verifyCookie()){if(r.hasShow){setTimeout(function(){o.passField.focus()},250);return}o.submit()}});NTES.event.addEvent(o.fieldEl,"keyup",function(){var e=o.trim(o.nameField.value),t=o.passField.value;if(o.nameTmp!=e||o.passTmp!=t){o.removeClass(this.parentNode,"tips-error");o.showError(o.tipText)}});e.extend({});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.utils");NTESCommonNavigator.utils.ChangeCookie=function(){var e=NTESCommonNavigator.base.Class(),t=document.createElement("div"),n="",r="163",i="",o="http://reg.163.com/chgcookie.jsp?",s="http://www.163.com/special/0077450P/login_frame.html",a='<iframe src="javascript:false;" name="changeCookie" frameborder="0" style="width:0;height:0;display:none;"></iframe>',u=function(e){try{document.body.removeChild(e)}catch(t){}},l=function(e){var l=null;t.innerHTML=a;i=NTES.cookie.get("USERTRACK");n=String(NTES.cookie.get("P_INFO")).split("|")[0];document.body.appendChild(l=t.firstChild);l.onload=l.onreadystatechange=function(){if(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"){setTimeout(function(){if(NTES.cookie.get("S_INFO")){e&&e()}u(l);l=null},400)}};l.src=o+["username="+n,"product="+r,"userip="+i,"retUrl="+s,"loginUrl="+s].join("&")};e.extend({invoke:function(e){NTES.ready(function(){l(e)})}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.data");NTESCommonNavigator.data.UserInfo=function(){var e=NTESCommonNavigator.base.Class(),t=NTESCommonNavigator.utils.mix,n=NTESCommonNavigator.core.Event.Base,r=null,i=null,o=NTES,s="",a="",u=s,l=function(){c()},c=function(){r=Spine.Model.setup("UserInfo",["userName","userMail","userDomain","userIp","userLogin","userProduct"]);r.include({validate:function(){}});i=r.create()},f=function(){var r=[],l=[],c="",f=0;s=String(o.cookie.get("P_INFO"));a=String(o.cookie.get("S_INFO"));r=s.split("|");l=a.split("|");c=r[0]||"";i=i.load({userName:t.encode(c.split("@")[0]),userMail:t.encode(c),userDomain:t.encode(c?c.split("@")[1]||"":""),userIp:t.encode(o.cookie.get("USERTRACK")||""),userLogin:!!c&&(!!a||r[2]==1),userProduct:t.encode(r[7]||"")}).save();if(s!=u||!s){e.trigger(n.DATA_CHANGED,i);u=s}},d=function(){return i},m=function(){return s},h=function(){return a};l();e.extend({refresh:function(){f();return e},getUserInfo:function(){return d()},getPInfo:function(){return m()},getSInfo:function(){return h()}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.data");NTESCommonNavigator.data.MailInfo=function(){var e=NTESCommonNavigator.base.Class(),t=NTESCommonNavigator.core.Constant,n=t.Domain.DOMAIN,r=t.Domain.API,i=NTESCommonNavigator.core.Event.Base,o="http://msg.",s="/cgi/mc?funcid=getusrnewmsgcnt&fid=1&addSubFdrs=1&language=0&style=0&template=newmsgres_setcookie.htm&df=www163&callback=fAccountCountCall&username=",a="",u="",l=null,c=null,f=function(){d()},d=function(){l=Spine.Model.setup("MailInfo",["newCount","totalCount","userName"]);l.include({validate:function(){}});c=l.create();m({})},m=function(e){var t=parseInt(e.newCount)||0,n=parseInt(e.totalCount)||0;c=c.load({newCount:t,totalCount:n,userName:e.userName||""}).save()},h=function(t,l){t&&p(t);l&&g(l);for(var f=0;f<n.length;f++){if(a===n[f]){NTES.ajax.importJs(o+r[f]+s+u);window.fAccountCountCall=function(t,n,r){m({newCount:t,totalCount:n,userName:r});e.trigger(i.DATA_LOADED,c)};break}}},p=function(e){e&&(u=e)},g=function(e){e&&(a=e)},v=function(){return c};f();e.extend({refresh:function(e,t){h(e,t)},getMailInfo:function(){return v()},setUserMail:function(e){p(e)},setUserDomain:function(e){g(e)}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.data");NTESCommonNavigator.data.LofterInfo=function(){var e=NTESCommonNavigator.base.Class(),t=NTESCommonNavigator.core.Constant,n=NTESCommonNavigator.core.Event.Base,r=null,i=null,o="",s="",a=function(){u()},u=function(){r=Spine.Model.setup("LofterInfo",["count"]);r.include({validate:function(){}});i=r.create();l({})},l=function(e){e=parseInt(e)||0,i=i.load({count:e}).save()},c=function(t){t&&f(t);o="http://www.lofter.com/newNotice.do?email="+s+"&from=163top&callback=lofterInfoCallback";NTES.ajax.importJs(o,function(){if(typeof window.lofterInfoCount!="undefined"){l(window.lofterInfoCount);e.trigger(n.DATA_LOADED,i)}},"UTF-8")},f=function(e){if(typeof e=="string"){s=e;return}throw"invalid arguments for setUsermail"},d=function(){return s};getLofterInfo=function(){return i};window.lofterInfoCallback=function(e){window.lofterInfoCount=e};a();e.extend({refresh:function(e){c(e)},setUserMail:function(e){e&&f(e)},getUserMail:function(){return d()},getLofterInfo:function(){return getLofterInfo()}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.ui");NTESCommonNavigator.ui.NavBar=function(){var e=NTESCommonNavigator.base.UI(),t=NTES,n=NTESCommonNavigator.utils.mix,r=".ntes-nav-msg-num",i=t("#js_N_navHighlight"),o=t("#js_N_navLoginBefore"),s=t("#js_N_NavLoginAfter"),a=t("#js_N_navUsername"),u=t("#js_N_navLogout"),l=t("#js_N_logined_warp"),c=t("#js_logined_suggest"),f=t("#js_login_suggest_wrap"),d=t("#js_N_navHighlight"),m=t("#js_mail_url"),h=t("#js_N_navMailMsg"),p=t("#js_N_navLofterMsg"),g=t("#js_lofter_icon_url"),v=document.getElementById("js_lofter_pop_url").getElementsByTagName("a");huatianMsg=t("#js_N_navHuatianMsg"),cookieNavHuatianShow="n_ht_s",huatianNavShow=false,Constant=NTESCommonNavigator.core.Constant,products=Constant.PRODUCTS,defaultProducts=Constant.DEFAULT_PRODUCTS,loginOutUrl=Constant.LOG_IN_OUT_URL,selectMenu=null,userInfo=null,mailInfo=null,lofterInfo=null,init=function(){bindEvent();selectMenu=new NTES.plugin.NTESSelectMenu},bindEvent=function(){var e=false;window.addEvent("scroll",function(){if(document.documentElement.scrollTop+document.body.scrollTop>0){if(!e){i.addCss("ntes-nav-login-scroll");l.addCss("ntes-nav-logined-scroll");e=true}}else{if(e){i.removeCss("ntes-nav-login-scroll");l.removeCss("ntes-nav-logined-scroll");e=false}}});t(h.parentNode).addEvent("click",function(){h.style.display="none"});t(p.parentNode).addEvent("click",function(){p.style.display="none"});t(huatianMsg.parentNode).addEvent("click",function(){huatianMsg.style.display="none";huatianNavShow&&NTES.cookie.set(cookieNavHuatianShow,0,"1d","163.com","/")})},login=function(e){userInfo=e;if(!userInfo){logout();return}var t=userInfo.userName,r=userInfo.userDomain,i=userInfo.userMail,l=/&df=163navi/i,c=products[r]?products[r].url:Constant.Path.DEFAULT_MAIL_PATH;c=c.replace(l,"&df=163nav_icon");a.innerHTML=t.length<12?i:t.substr(0,12)+"...@"+r;u.href=loginOutUrl+"?username="+t+"&url="+n.encode(location.href);m.href=c;g.href+="&logined=true";for(var f=0,d=v.length;f<d;f++){v[f].href+="&logined=true"}setLoginSuggest(userInfo.userProduct);o.style.display="none";s.style.display="block";var h=NTES.cookie.get(cookieNavHuatianShow);if(h){if(parseInt(h)){setHuatianInfo(true)}else{setHuatianInfo(false)}}else if(Math.random()<=.5){NTES.cookie.set(cookieNavHuatianShow,1,"1d","163.com","/");setHuatianInfo(true)}},setLoginSuggest=function(e){var t=e?!!~e.indexOf(",")?e.split(","):e.split("&"):[],r=0,i=t.length>defaultProducts.length?defaultProducts.length:t.length,o="",s=["reg"],a=[];for(;r<i;r++){o=t[r];!!products[o]&&s.push(o)}if(s.length==1){s=s.concat(defaultProducts)}if(!!~Constant.Domain.DOMAIN.indexOf(userInfo.userDomain)){s.splice(1,0,userInfo.userDomain)}while(s.length){o=s[0];a.push((s.length==1?"<li class='last'>":"<li>")+"<a href='"+products[o].url+"'><span>\u8fdb\u5165"+products[o].name+"</span></a></li>");s.shift()}c.innerHTML=a.join("").replace(/pInfo/g,n.encode(userInfo.userMail))},logout=function(){a.innerHTML="";c.innerHTML="";m.href=Constant.Path.DEFAULT_MAIL_PATH;u.href="javascript: void(0)";o.style.display="block";s.style.display="none";g.href=g.href.replace("&logined=true","");for(var e=0,t=v.length;e<t;e++){v[e].href=v[e].href.replace("&logined=true","")}userInfo=null;setMailInfo(null);setLofterInfo(null);setHuatianInfo(null)},setMsg=function(e,n,i){var o=t(r,e).get(0);if(!i){if(n>99){n="99+"}if(n<0){n=0}}if(!o||!e){return}if(n){o.innerHTML=n;e.style.display="block"}else{o.innerHTML="";e.style.display="none"}},setHuatianInfo=function(e){huatianNavShow=e;setMsg(huatianMsg,e?"N":"",true)},setLofterInfo=function(e){setMsg(p,e?e.count:0);if(e&&e.count>0){g.href=g.href.replace("qb163sydl_20140917_01","qb163sydl_20140917_02")}else{g.href=g.href.replace("qb163sydl_20140917_02","qb163sydl_20140917_01")}lofterInfo=e},setMailInfo=function(e){setMsg(h,e?e.newCount:0);mailInfo=e},unFoldUserCenter=function(){f.style.display="block";setTimeout(function(){f.style.display=""},4e3)};init();e.extend({login:function(e){login(e)},logout:function(){logout()},setLofterInfo:function(e){setLofterInfo(e)},setMailInfo:function(e){setMailInfo(e)},setHuatianInfo:function(e){setHuatianInfo(e)},unFoldUserCenter:function(){unFoldUserCenter()}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.ui");NTESCommonNavigator.ui.Login=function(){var e=NTESCommonNavigator.base.UI(),t=NTES,n=t("#js_N_navHighlight"),r=t("#js_loginframe_username"),i=t.util,o=i.extend,s=250,a=t("#js_passportUserNameList"),u=t("#js_N_navHighlight .ntes-nav-login-title"),l=t("#js_N_navHighlight .ntes-nav-loginframe-pop"),c=false,f=t(document.body),d=null,m={shake:"ue-shake"},h="",p=function(){c=g(l);n.addCss("ntes-nav-login-normal");u.addEvent("click",v);u.addEvent("mouseover",y);u.addEvent("mouseout",C);l.addEvent("mouseover",S);f.addEvent("click",T);a=a?a.get(0):null},g=function(e){if(t.style.getCurrentStyle(e,"display")!="none"){return true}return false},v=function(e){if(g(l)){w()}else{b()}return false},N=function(){if(d){clearTimeout(d);d=null}},E=function(e){d=setTimeout(function(){e&&e()},s)},y=function(e){N();b()},C=function(e){N();E(function(){w()})},S=function(e){N()},T=function(e){if(!c){return}var t=e.target||e.srcElement,n=l.get(0),r=u.get(0);while(t){if(t==n||t==r||t==a){return}t=t.parentNode}w();return false},_=function(e){w()},I=function(e){A("shake")},w=function(){l.get(0).style.display="none";c=false;n.addCss("ntes-nav-login-normal");n.removeCss("ntes-nav-login-active");l.removeCss("ue-animation");h&&l.removeCss(h)},b=function(){l.get(0).style.display="block";c=true;n.addCss("ntes-nav-login-active");n.removeCss("ntes-nav-login-normal");l.addCss("ue-animation")},A=function(e){var t=m[e]||"";h&&l.removeCss(h);t&&l.addCss(t);h=t;h&&setTimeout(function(){l.removeCss(h)},1e3)},L=function(e){r.value=e||""};p();e.extend({show:function(){b()},hide:function(){w()},success:function(){_()},fail:function(){I()},setUserName:function(e){L(e)}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.core");NTESCommonNavigator.core.Model=function(){var e=NTESCommonNavigator.base.Class(),t=NTESCommonNavigator.core.Event.Base,n=NTESCommonNavigator.core.Event.Model,r=NTESCommonNavigator.data.UserInfo(),i=NTESCommonNavigator.data.MailInfo(),o=NTESCommonNavigator.data.LofterInfo(),s=NTESCommonNavigator.utils.ChangeCookie(),a=function(){i.bind(t.DATA_LOADED,c);o.bind(t.DATA_LOADED,f);r.bind(t.DATA_CHANGED,l)},u=function(){var e=r.getUserInfo();i.refresh(e.userName,e.userDomain);o.refresh(e.userMail)},l=function(n){if(n.userLogin){if(!!r.getSInfo()){u()}else{s.invoke(function(){u()})}}e.trigger(t.DATA_CHANGED,n)},c=function(t){e.trigger(n.MAIL_INFO_LOADED,t)},f=function(t){e.trigger(n.LOFTER_INFO_LOADED,t)},d=function(){return r.getUserInfo()};a();e.extend({refresh:function(){r.refresh()},getUserInfo:function(){return d()}});return e};NTESCommonNavigator.namespace("NTESCommonNavigator.core");NTESCommonNavigator.core.View=function(e){var t=NTESCommonNavigator.base.Class(),n=NTESCommonNavigator.ui.NavBar(),r=NTESCommonNavigator.ui.Login(),i=NTESCommonNavigator.core.Event.Model,o=NTESCommonNavigator.core.Event.Base,s=function(){e.bind(i.MAIL_INFO_LOADED,a);e.bind(i.LOFTER_INFO_LOADED,u);e.bind(o.DATA_CHANGED,l)},a=function(e){n.setMailInfo(e)},u=function(e){n.setLofterInfo(e)},l=function(e){if(e.userLogin){n.login(e)}else{n.logout();if(e.userMail){r.setUserName(e.userMail)}}},c=function(){r.success();n.unFoldUserCenter()},f=function(){r.fail()};s();t.extend({loginSuccess:function(){c()},loginFail:function(){f()}});return t};NTESCommonNavigator.namespace("NTESCommonNavigator.core");NTESCommonNavigator.core.Controller=function(){var e=NTESCommonNavigator.base.Class(),t=NTESCommonNavigator.core.Model(),n=NTESCommonNavigator.core.View(t),r=NTESCommonNavigator.utils.Login(),i=NTESCommonNavigator.core.Event.Base,o=NTESCommonNavigator.core.Event.Model,s=function(){r.bind(i.LOGIN_SUCCESS,c);r.bind(i.LOGIN_FAIL,f);t.bind(i.DATA_CHANGED,l);t.bind(o.MAIL_INFO_LOADED,a);t.bind(o.LOFTER_INFO_LOADED,u)},a=function(t){e.trigger(o.MAIL_INFO_LOADED,t)},u=function(t){e.trigger(o.LOFTER_INFO_LOADED,t)},l=function(t){e.trigger(i.DATA_CHANGED,t)},c=function(){t.refresh();n.loginSuccess()},f=function(){t.refresh();n.loginFail()};s();e.extend({refresh:function(){t.refresh()},getUserInfo:function(){return t.getUserInfo()}});return e};